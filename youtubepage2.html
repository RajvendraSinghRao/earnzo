let player;
let countdown;
let totalTime = 40; // Total time for coins
let elapsedTime = 0; // Track elapsed time
const timerDisplay = document.getElementById('timer');
const button = document.getElementById('myButton');

function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '360',
        width: '350',
        videoId: '9eUS30lGlKA',
        events: {
            'onStateChange': onPlayerStateChange
        }
    });
}

function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.PLAYING) {
        startTimer();
    } else if (event.data == YT.PlayerState.PAUSED) {
        pauseTimer();
    } else if (event.data == YT.PlayerState.ENDED) {
        resetTimer();
    }
}

function startTimer() {
    // Start counting from the elapsed time, do not reset it
    timerDisplay.textContent = `Waiting time: ${totalTime - elapsedTime} seconds`;
    countdown = setInterval(() => {
        if (elapsedTime < totalTime) {
            elapsedTime++;
            timerDisplay.textContent = `Waiting time: ${totalTime - elapsedTime} seconds`;
            if (elapsedTime >= totalTime) {
                clearInterval(countdown);
                button.style.display = 'block'; // Show collect coin button
            }
        }
    }, 1000);
}

function pauseTimer() {
    clearInterval(countdown); // Stop the timer, but don't reset elapsedTime
}

function resetTimer() {
    clearInterval(countdown); // Reset the timer
    elapsedTime = 0; // Reset elapsed time
    timerDisplay.textContent = `Waiting time: ${totalTime} seconds`;
    button.style.display = 'none'; // Hide collect coin button
}

button.addEventListener('click', function() {
    let coins = Number(localStorage.getItem('coins')) || 0;
    coins += 2; // Give 2 coins
    localStorage.setItem('coins', coins);
    alert(`Coins collected! Total coins: ${coins}`);
    button.style.display = 'none'; // Hide collect coin button after clicked
    resetTimer(); // Reset timer
    window.location.href = 'coin_counter.html'; // Redirect to coin_counter.html
});

// Load the IFrame Player API code asynchronously
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
const firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
